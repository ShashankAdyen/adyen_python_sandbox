<html>

<head>
	<link rel="stylesheet" type="text/css" href="styles/style.css"></link>
</head>

<body>
	<h4>Checkout should appear below:</h4>
	<iframe class="checkout-iframe" src="checkout_iframe.html"></iframe>

	<h4>Payment result:</h4>
	<div id="paymentResult">"Patience is a virtue" - Confucius probably</div>
	<div id="verifyContainer" class="inactive">
		<h4>Verify result:</h4>
		<input type="button" class="submitBtn" id="verifyBtn" value="Verify Payment"/>
		<div id="verifyResult"></div>
	</div>
</body>

</html>

<script>

// Send request to server
function AJAXPost(path, headers, params, method, callback) {
	var request = new XMLHttpRequest();
	request.open(method || "POST", path, true);
	request.onreadystatechange = callback;

	for (var key in headers) {
		request.setRequestHeader(key, headers[key]);
	}

	request.send(params);
};

function setPaymentResult(text) {
	document.getElementById("paymentResult").innerHTML = text;
}

function setupVerify(pHookData) {
	// Set up verify call
	document.getElementById("verifyBtn").addEventListener("click", function() {
		document.getElementById("verifyBtn").remove()
		var url = "http://localhost:8000/cgi-bin/submit.py";
		var postData = "endpoint=checkout_verify&payload=" + pHookData.payload;
		
		AJAXPost(url + "?" + postData, "", "", "POST", function() {
			document.getElementById("verifyResult").innerHTML = this.responseText;
		});
	});
	document.getElementById("verifyContainer").classList.remove("inactive");
}

</script>